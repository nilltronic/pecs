<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>PECS Card Creator â€” Local Sample Images with Preview</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, button { margin: 6px 0; padding: 8px; }
    #preview, #tempPreview { display:flex; flex-wrap:wrap; gap:10px; margin-top:12px; }
    .card { border:1px solid #ccc; border-radius:6px; width:120px; padding:6px; text-align:center; background:#fafafa; }
    .card img { max-width:100%; height:auto; display:block; margin:0 auto 6px; }
    #sampleImages img { width:80px; margin:5px; cursor:pointer; border:1px solid #ccc; border-radius:4px; }
    #sampleImages img:hover { border-color:#000; }
  </style>
</head>
<body>
  <h1>PECS Card Creator</h1>

  <div>
    <input type="text" id="cardText" placeholder="Enter card text" style="width:200px;">
    <input type="button" id="loadFileXml" value="Choose Image" onclick="document.getElementById('cardImage').click();" />
    <input type="file" style="display:none;" id="cardImage" name="cardImage"/>
    
    <button onclick="addCard()">Add Card</button>
    <button onclick="generatePDF()">Generate PDF</button>
    <button onclick="clearCards()">Clear</button>
    <br>
    
    <label for="cardColor">Text color:</label>
    <input type="color" id="cardColor" value="#000000">
    <br>

    <label>
      <input type="checkbox" id="stackingToggle" checked>
      Use stacking tabs (taller cards)
    </label>
  </div>

  <h3>Card in Progress</h3>
  <div id="tempPreview"></div>

  <h3>Added Cards</h3>
  <div id="preview"></div>

  <!-- Sample images (local files) -->
  <div id="sampleImages">
    <h3>Sample Images</h3>
    <img src="images/yes.png" alt="Sample 1" onclick="useSampleImage(this)">
    <img src="images/no.png" alt="Sample 2" onclick="useSampleImage(this)">
    <img src="images/red.png" alt="Sample 3" onclick="useSampleImage(this)">
    <img src="images/orange.png" alt="Sample 4" onclick="useSampleImage(this)">
    <img src="images/yellow.png" alt="Sample 5" onclick="useSampleImage(this)">
    <img src="images/green.png" alt="Sample 6" onclick="useSampleImage(this)">
    <img src="images/blue.png" alt="Sample 7" onclick="useSampleImage(this)">
    <img src="images/purple.png" alt="Sample 8" onclick="useSampleImage(this)">
    <img src="images/toilet.png" alt="Sample 9" onclick="useSampleImage(this)">
    <img src="images/drink.png" alt="Sample 10" onclick="useSampleImage(this)">
    <img src="images/snack.png" alt="Sample 11" onclick="useSampleImage(this)">
    <img src="images/wash.png" alt="Sample 12" onclick="useSampleImage(this)">
  </div>

  <!-- jsPDF -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script>
    const { jsPDF } = window.jspdf;
    const cards = [];
    let selectedSampleImage = null; // store chosen sample image
    let tempPreviewImage = null;    // used for live preview

    // Add card to permanent list
    function addCard() {
      const text = document.getElementById('cardText').value.trim();
      const color = document.getElementById('cardColor').value;
      const fileInput = document.getElementById('cardImage');

      if (!text) {
        alert('Please enter card text.');
        return;
      }

      if (fileInput.files.length > 0) {
        const reader = new FileReader();
        reader.onloadend = () => {
          cards.push({ text, color, image: reader.result });
          resetInputs();
          renderPreview();
        };
        reader.readAsDataURL(fileInput.files[0]);
      } else if (selectedSampleImage) {
        cards.push({ text, color, image: selectedSampleImage });
        resetInputs();
        renderPreview();
      } else {
        alert('Please choose an image (upload or sample).');
      }
    }

    // Choose a sample image
    function useSampleImage(imgEl) {
      selectedSampleImage = imgEl.src; 
      tempPreviewImage = imgEl.src;   
      updateTempPreview();

      document.querySelectorAll("#sampleImages img").forEach(img => {
        img.style.borderColor = "#ccc";
      });
      imgEl.style.borderColor = "blue";
    }

    // File upload preview
    document.getElementById('cardImage').addEventListener('change', function() {
      if (this.files.length > 0) {
        const reader = new FileReader();
        reader.onloadend = () => {
          tempPreviewImage = reader.result;
          updateTempPreview();
        };
        reader.readAsDataURL(this.files[0]);
      }
    });

    // Live preview for "card in progress"
    function updateTempPreview() {
      const text = document.getElementById('cardText').value.trim();
      const color = document.getElementById('cardColor').value;
      const preview = document.getElementById('tempPreview');
      preview.innerHTML = '';

      if (tempPreviewImage) {
        const d = document.createElement('div');
        d.className = 'card';
        d.innerHTML = `
          <div style="width:100px; height:80px; display:flex; align-items:center; justify-content:center; margin:0 auto 6px;">
            <img src="${tempPreviewImage}" alt="preview" style="max-width:100%; max-height:100%;">
          </div>
          <div style="color:${color};"><strong>${escapeHtml(text)}</strong></div>
        `;
        preview.appendChild(d);
      }
    }

    // Reset inputs after adding card
    function resetInputs() {
      document.getElementById('cardText').value = '';
      document.getElementById('cardImage').value = '';
      selectedSampleImage = null;
      tempPreviewImage = null;
      document.querySelectorAll("#sampleImages img").forEach(img => {
        img.style.borderColor = "#ccc";
      });
      document.getElementById('tempPreview').innerHTML = '';
    }

    // Render added cards
    function renderPreview() {
      const preview = document.getElementById('preview');
      preview.innerHTML = '';
      cards.forEach((c, i) => {
        const d = document.createElement('div');
        d.className = 'card';
        d.innerHTML = `
          <div style="width:100px; height:80px; display:flex; align-items:center; justify-content:center; margin:0 auto 6px;">
            <img src="${c.image}" alt="img" style="max-width:100%; max-height:100%;">
          </div>
          <div style="color:${c.color};"><strong>${escapeHtml(c.text)}</strong></div>
          <div style="margin-top:6px;"><button onclick="removeCard(${i})">Remove</button></div>
        `;
        preview.appendChild(d);
      });
    }

    function removeCard(index) { cards.splice(index, 1); renderPreview(); }
    function clearCards() { if (confirm('Clear all cards?')) { cards.length = 0; renderPreview(); } }
    function escapeHtml(s){ return s ? s.replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])) : ''; }

    // PDF Generation (unchanged for now)
    async function generatePDF() {
      if (cards.length === 0) { alert('No cards to generate.'); return; }
      const doc = new jsPDF();
      let y = 10;
      for (let c of cards) {
        doc.text(c.text, 10, y);
        y += 20;
      }
      doc.save('pecs-cards.pdf');
    }
  </script>
</body>
</html>
